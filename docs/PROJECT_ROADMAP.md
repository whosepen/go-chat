# Go-Chat é¡¹ç›®æ”¹è¿›è·¯çº¿å›¾

> æœ¬æ–‡æ¡£è®°å½•é¡¹ç›®å¾…åŠäº‹é¡¹ã€API æ¥å£æ–‡æ¡£å’Œæ”¹è¿›æ€è·¯ï¼Œç›®æ ‡æ˜¯æ„å»ºä¼ä¸šçº§å³æ—¶é€šè®¯åç«¯ã€‚

---

## ç›®å½•
- [é¡¹ç›®ç°çŠ¶](#é¡¹ç›®ç°çŠ¶)
- [å¾…åŠæ¸…å•](#å¾…åŠæ¸…å•)
- [API æ¥å£æ–‡æ¡£](#api-æ¥å£æ–‡æ¡£)
- [æ”¹è¿›æ€è·¯](#æ”¹è¿›æ€è·¯)
- [æŠ€æœ¯æ¶æ„æ¼”è¿›](#æŠ€æœ¯æ¶æ„æ¼”è¿›)

---

## é¡¹ç›®ç°çŠ¶

### å·²å®ç°åŠŸèƒ½

| æ¨¡å— | åŠŸèƒ½ | çŠ¶æ€ | æ–‡ä»¶ä½ç½® |
|------|------|------|----------|
| ç”¨æˆ·ç³»ç»Ÿ | ç”¨æˆ·æ³¨å†Œ | âœ… | [user_api.go](../internal/api/user_api.go) |
| ç”¨æˆ·ç³»ç»Ÿ | ç”¨æˆ·ç™»å½• (JWT) | âœ… | [user_api.go](../internal/api/user_api.go) |
| ç”¨æˆ·ç³»ç»Ÿ | è·å–ç”¨æˆ·ä¿¡æ¯ | âœ… | [user_api.go](../internal/api/user_api.go) |
| æ¶ˆæ¯ç³»ç»Ÿ | å•èŠæ¶ˆæ¯å­˜å‚¨ | âœ… | [message.go](../internal/models/message.go) |
| æ¶ˆæ¯ç³»ç»Ÿ | å†å²æ¶ˆæ¯æŸ¥è¯¢ | âœ… | [history_msg.go](../internal/service/history_msg.go) |
| WebSocket | é•¿è¿æ¥å»ºç«‹ | âœ… | [chat_api.go](../internal/api/chat_api.go) |
| WebSocket | å®æ—¶æ¶ˆæ¯æ¨é€ | âœ… | [chat_manager.go](../internal/service/chat_manager.go) |
| åŸºç¡€æ¶æ„ | Gin è·¯ç”± | âœ… | [router.go](../internal/routers/router.go) |
| åŸºç¡€æ¶æ„ | GORM æ•°æ®åº“ | âœ… | [db.go](../internal/pkg/initial/db.go) |
| åŸºç¡€æ¶æ„ | Swagger æ–‡æ¡£ | âœ… | [docs/](../docs/) |

### å­˜åœ¨çš„é—®é¢˜

#### 1. åŠŸèƒ½ç¼ºå¤±
- âŒ ç¾¤ç»„åŠŸèƒ½ (protocol å®šä¹‰ä½†æœªå®ç°)
- âŒ æ¶ˆæ¯æ’¤å›/åˆ é™¤/ç¼–è¾‘
- âŒ å·²è¯»/æœªè¯»çŠ¶æ€
- âŒ å¥½å‹/å…³æ³¨ç³»ç»Ÿ
- âŒ é»‘åå•
- âŒ æ–‡ä»¶ä¸Šä¼ æœåŠ¡
- âŒ ç¦»çº¿æ¶ˆæ¯æ¨é€

#### 2. ä»£ç è´¨é‡
- âŒ æ—¥å¿—æœªå†™å…¥æ–‡ä»¶
- âŒ ç¼ºå°‘å•å…ƒæµ‹è¯•
- âŒ é”™è¯¯å¤„ç†ä¸å®Œå–„
- âŒ é‡å¤ DTO å®šä¹‰ (`dto/` vs `service/dto.go`)

#### 3. ä¼ä¸šçº§åŠŸèƒ½
- âŒ Redis ç¼“å­˜ (å·²é…ç½®æœªä½¿ç”¨)
- âŒ æ¶ˆæ¯é˜Ÿåˆ—
- âŒ é™æµ/ç†”æ–­
- âŒ é“¾è·¯è¿½è¸ª
- âŒ ç›‘æ§æŒ‡æ ‡

---

## å¾…åŠæ¸…å•

### ğŸ”´ é«˜ä¼˜å…ˆçº§ (æ ¸å¿ƒåŠŸèƒ½)

- [ ] **å®Œå–„ç”¨æˆ·ç³»ç»Ÿ**
  - [ ] æ›´æ–°ç”¨æˆ·èµ„æ–™æ¥å£ (æ˜µç§°ã€å¤´åƒ)
  - [ ] ä¿®æ”¹å¯†ç æ¥å£
  - [ ] ç”¨æˆ·æœç´¢åŠŸèƒ½
  - [ ] è·å–å…¶ä»–ç”¨æˆ·ä¿¡æ¯

- [ ] **æ¶ˆæ¯åŠŸèƒ½å¢å¼º**
  - [ ] æ¶ˆæ¯åˆ†é¡µæŸ¥è¯¢
  - [ ] æ¶ˆæ¯æ’¤å›åŠŸèƒ½
  - [ ] æ¶ˆæ¯åˆ é™¤åŠŸèƒ½
  - [ ] å·²è¯»/æœªè¯»çŠ¶æ€

- [ ] **WebSocket ä¼˜åŒ–**
  - [ ] å¿ƒè·³è¶…æ—¶æ£€æµ‹
  - [ ] æ–­çº¿é‡è¿æœºåˆ¶
  - [ ] æ¶ˆæ¯ ACK ç¡®è®¤

- [ ] **å®ç°ç¾¤ç»„åŠŸèƒ½**
  - [ ] åˆ›å»ºç¾¤ç»„
  - [ ] åŠ å…¥/é€€å‡ºç¾¤ç»„
  - [ ] ç¾¤æ¶ˆæ¯æ¨é€
  - [ ] ç¾¤æˆå‘˜ç®¡ç†

### ğŸŸ¡ ä¸­ä¼˜å…ˆçº§ (ä¼ä¸šåŠŸèƒ½)

- [ ] **ç¼“å­˜å±‚ (Redis)**
  - [ ] ç”¨æˆ·ä¿¡æ¯ç¼“å­˜
  - [ ] åœ¨çº¿çŠ¶æ€ç¼“å­˜
  - [ ] ä¼šè¯ç¼“å­˜

- [ ] **åŸºç¡€è®¾æ–½**
  - [ ] æ—¥å¿—å†™å…¥æ–‡ä»¶
  - [ ] æ—¥å¿—åˆ†çº§ä¸åˆ‡å‰²
  - [ ] è¯·æ±‚æ—¥å¿—ä¸­é—´ä»¶
  - [ ] é™æµä¸­é—´ä»¶

- [ ] **æ–‡ä»¶æœåŠ¡**
  - [ ] å›¾ç‰‡ä¸Šä¼ 
  - [ ] è¯­éŸ³ä¸Šä¼ 
  - [ ] æ–‡ä»¶ä¸Šä¼  OSS é›†æˆ

### ğŸŸ¢ ä½ä¼˜å…ˆçº§ (å¢å¼ºåŠŸèƒ½)

- [ ] å¥½å‹/å…³æ³¨ç³»ç»Ÿ
- [ ] é»‘åå•åŠŸèƒ½
- [ ] æ¶ˆæ¯ç¿»è¯‘
- [ ] æ¶ˆæ¯æœç´¢ (Elasticsearch)
- [ ] æ¶ˆæ¯æ¼«æ¸¸ (å¤šç«¯åŒæ­¥)
- [ ] é›†æˆæ¶ˆæ¯é˜Ÿåˆ— (Kafka/RabbitMQ)
- [ ] é“¾è·¯è¿½è¸ª (Jaeger)
- [ ] ç›‘æ§ (Prometheus)

---

## API æ¥å£æ–‡æ¡£

### åŸºç¡€ä¿¡æ¯

| é¡¹ç›® | å€¼ |
|------|-----|
| Base URL | `http://localhost:8080` |
| API ç‰ˆæœ¬ | `v1` (å¾…å®ç°) |
| è®¤è¯æ–¹å¼ | Bearer Token (JWT) |
| å“åº”æ ¼å¼ | JSON |

### ç»Ÿä¸€å“åº”æ ¼å¼

```json
{
  "code": 0,
  "msg": "success",
  "data": { }
}
```

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| code | int | çŠ¶æ€ç  (0=æˆåŠŸ, å…¶ä»–=é”™è¯¯) |
| msg | string | æ¶ˆæ¯ |
| data | object | æ•°æ® (å¯é€‰) |

---

### ç”¨æˆ·æ¨¡å—

#### 1. ç”¨æˆ·æ³¨å†Œ

```
POST /api/user/register
```

**è¯·æ±‚å‚æ•°:**

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| username | string | æ˜¯ | ç”¨æˆ·å (3-20ä½) |
| password | string | æ˜¯ | å¯†ç  (æœ€å°‘6ä½) |
| email | string | å¦ | é‚®ç®± |

**è¯·æ±‚ç¤ºä¾‹:**
```json
{
  "username": "testuser",
  "password": "123456",
  "email": "test@example.com"
}
```

**å“åº”ç¤ºä¾‹:**
```json
{
  "code": 0,
  "msg": "æ³¨å†ŒæˆåŠŸ",
  "data": null
}
```

**é”™è¯¯ç :**
| code | è¯´æ˜ |
|------|------|
| -1 | ç”¨æˆ·åå·²å­˜åœ¨ |
| -1 | å‚æ•°é”™è¯¯ |

---

#### 2. ç”¨æˆ·ç™»å½•

```
POST /api/user/login
```

**è¯·æ±‚å‚æ•°:**

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| username | string | æ˜¯ | ç”¨æˆ·å |
| password | string | æ˜¯ | å¯†ç  |

**è¯·æ±‚ç¤ºä¾‹:**
```json
{
  "username": "testuser",
  "password": "123456"
}
```

**å“åº”ç¤ºä¾‹:**
```json
{
  "code": 0,
  "msg": "ç™»å½•æˆåŠŸ",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIs...",
    "username": "testuser",
    "nickname": "testuser"
  }
}
```

---

#### 3. è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯

```
GET /api/user/info
```

**è¯·æ±‚å¤´:**
```
Authorization: Bearer <token>
```

**å“åº”ç¤ºä¾‹:**
```json
{
  "code": 0,
  "msg": "success",
  "data": {
    "id": 1,
    "username": "testuser",
    "nickname": "testuser",
    "email": "test@example.com"
  }
}
```

---

#### 4. æ›´æ–°ç”¨æˆ·èµ„æ–™ [å¾…å®ç°]

```
PUT /api/user/profile
```

**è¯·æ±‚å‚æ•°:**

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| nickname | string | å¦ | æ˜µç§° |
| avatar | string | å¦ | å¤´åƒURL |
| bio | string | å¦ | ä¸ªäººç®€ä»‹ |

---

#### 5. ä¿®æ”¹å¯†ç  [å¾…å®ç°]

```
PUT /api/user/password
```

**è¯·æ±‚å‚æ•°:**

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| old_password | string | æ˜¯ | æ—§å¯†ç  |
| new_password | string | æ˜¯ | æ–°å¯†ç  |

---

#### 6. è·å–å…¶ä»–ç”¨æˆ·ä¿¡æ¯ [å¾…å®ç°]

```
GET /api/users/:id
```

**å“åº”ç¤ºä¾‹:**
```json
{
  "code": 0,
  "msg": "success",
  "data": {
    "id": 2,
    "nickname": "otheruser",
    "avatar": "https://...",
    "online": true
  }
}
```

---

### èŠå¤©æ¨¡å—

#### 7. WebSocket è¿æ¥

```
GET /api/ws?token=<token>
```

**è¿æ¥ç¤ºä¾‹:**
```javascript
const ws = new WebSocket('ws://localhost:8080/api/ws?token=your_jwt_token');
```

**æ¶ˆæ¯åè®®:**

```json
{
  "type": 1,
  "content": "hello",
  "target_id": 2,
  "media": 1
}
```

| type | è¯´æ˜ |
|------|------|
| 0 | å¿ƒè·³ |
| 1 | ç™»å½•/ä¸Šçº¿ |
| 2 | å•èŠæ¶ˆæ¯ |
| 3 | ç¾¤èŠæ¶ˆæ¯ (å¾…å®ç°) |

| media | è¯´æ˜ |
|-------|------|
| 1 | æ–‡æœ¬ |
| 2 | å›¾ç‰‡ |
| 3 | éŸ³é¢‘ |

---

#### 8. è·å–èŠå¤©å†å²

```
GET /api/chat/history?target_id=2&page=1&size=20
```

**è¯·æ±‚å‚æ•°:**

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| target_id | int | æ˜¯ | å¯¹æ–¹ç”¨æˆ·ID |
| page | int | å¦ | é¡µç  (é»˜è®¤1) |
| size | int | å¦ | æ¯é¡µæ•°é‡ (é»˜è®¤20, æœ€å¤§100) |

**å“åº”ç¤ºä¾‹:**
```json
{
  "code": 0,
  "msg": "å†å²è®°å½•æ‹‰å–æˆåŠŸ",
  "data": [
    {
      "id": 1,
      "from_user_id": 1,
      "to_user_id": 2,
      "content": "ä½ å¥½",
      "type": 2,
      "media": 1,
      "created_at": "2024-01-01 12:00:00"
    }
  ]
}
```

---

#### 9. å‘é€æ¶ˆæ¯ (HTTP) [å¾…å®ç°]

```
POST /api/messages
```

**è¯·æ±‚å‚æ•°:**

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| target_id | uint | æ˜¯ | æ¥æ”¶è€…ID |
| content | string | æ˜¯ | æ¶ˆæ¯å†…å®¹ |
| media | int | æ˜¯ | åª’ä½“ç±»å‹ (1=æ–‡æœ¬, 2=å›¾ç‰‡, 3=éŸ³é¢‘) |

---

#### 10. æ’¤å›æ¶ˆæ¯ [å¾…å®ç°]

```
PUT /api/messages/:id/recall
```

---

#### 11. åˆ é™¤æ¶ˆæ¯ [å¾…å®ç°]

```
DELETE /api/messages/:id
```

---

### ç¾¤ç»„æ¨¡å— [å¾…å®ç°]

#### 12. åˆ›å»ºç¾¤ç»„

```
POST /api/groups
```

**è¯·æ±‚å‚æ•°:**

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| name | string | æ˜¯ | ç¾¤åç§° |
| description | string | å¦ | ç¾¤æè¿° |
| member_ids | []uint | æ˜¯ | åˆå§‹æˆå‘˜ID |

---

#### 13. è·å–ç¾¤ç»„åˆ—è¡¨

```
GET /api/groups
```

---

#### 14. åŠ å…¥ç¾¤ç»„

```
POST /api/groups/:id/join
```

---

#### 15. é€€å‡ºç¾¤ç»„

```
POST /api/groups/:id/leave
```

---

#### 16. ç¾¤æ¶ˆæ¯

```
GET /api/groups/:id/messages
```

---

### å¥½å‹æ¨¡å— [å¾…å®ç°]

#### 17. æ·»åŠ å¥½å‹

```
POST /api/friends
```

---

#### 18. å¥½å‹åˆ—è¡¨

```
GET /api/friends
```

---

#### 19. åˆ é™¤å¥½å‹

```
DELETE /api/friends/:id
```

---

#### 20. é»‘åå•

```
GET /api/blacklist
POST /api/blacklist/:id
DELETE /api/blacklist/:id
```

---

## æ”¹è¿›æ€è·¯

### 1. åˆ†å±‚æ¶æ„ä¼˜åŒ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   API Layer (api)                    â”‚
â”‚         è´Ÿè´£è¯·æ±‚/å“åº”ã€å‚æ•°æ ¡éªŒã€DTOè½¬æ¢              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Service Layer (service)               â”‚
â”‚              ä¸šåŠ¡é€»è¾‘ç¼–æ’ã€äº‹åŠ¡ç®¡ç†                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Model Layer (models)                 â”‚
â”‚              æ•°æ®åº“å®ä½“ã€æ•°æ®ç»“æ„å®šä¹‰                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ”¹è¿›å»ºè®®:**
- API å±‚åªåš DTO è½¬æ¢ï¼Œä¸åŒ…å«ä¸šåŠ¡é€»è¾‘
- Service å±‚å¤„ç†æ‰€æœ‰ä¸šåŠ¡é€»è¾‘
- ä½¿ç”¨ interface å®šä¹‰æœåŠ¡æ¥å£ï¼Œä¾¿äºæµ‹è¯•å’Œæ›¿æ¢å®ç°

### 2. é”™è¯¯å¤„ç†æ”¹è¿›

```go
// ç»Ÿä¸€é”™è¯¯ç å®šä¹‰
const (
    CodeSuccess = 0
    CodeError   = -1

    // ç”¨æˆ·é”™è¯¯ 1001-1099
    CodeUserNotFound     = 1001
    CodeUserPasswordWrong = 1002
    CodeUserAlreadyExist = 1003

    // æ¶ˆæ¯é”™è¯¯ 2001-2099
    CodeMsgNotFound      = 2001
    CodeMsgRecallTimeout = 2002

    // ç¾¤ç»„é”™è¯¯ 3001-3099
    CodeGroupNotFound    = 3001
    CodeGroupMemberFull  = 3002
)
```

### 3. æ—¥å¿—è§„èŒƒ

```go
// ä½¿ç”¨ zap è®°å½•ç»“æ„åŒ–æ—¥å¿—
global.Log.Info("user login",
    zap.Uint("user_id", userID),
    zap.String("username", username),
    zap.String("ip", ip),
)

// è®°å½•è¯·æ±‚æ—¥å¿—ä¸­é—´ä»¶
func Logger() gin.HandlerFunc {
    return func(c *gin.Context) {
        start := time.Now()
        path := c.Request.URL.Path
        // ... è®°å½•è¯·æ±‚ä¿¡æ¯
    }
}
```

### 4. WebSocket ä¼˜åŒ–

```go
// å¿ƒè·³æ£€æµ‹
const (
    HeartbeatInterval = 30 * time.Second
    HeartbeatTimeout  = 60 * time.Second
)

// æ¶ˆæ¯ ACK ç¡®è®¤
type AckMessage struct {
    MsgID   string `json:"msg_id"`
    Status  int    `json:"status"` // 0=å·²æ¥æ”¶, 1=å·²è¯»
}
```

### 5. ç¼“å­˜ç­–ç•¥ (Redis)

| æ•°æ® | ç¼“å­˜ç­–ç•¥ | è¿‡æœŸæ—¶é—´ |
|------|----------|----------|
| ç”¨æˆ·ä¿¡æ¯ | Cache-Aside | 1å°æ—¶ |
| åœ¨çº¿çŠ¶æ€ | Write-Through | å®æ—¶ |
| ä¼šè¯åˆ—è¡¨ | Cache-Aside | 30åˆ†é’Ÿ |

---

## æŠ€æœ¯æ¶æ„æ¼”è¿›

### å½“å‰æ¶æ„

```
Client â”€â”€HTTPâ”€â”€> Gin â”€â”€> Service â”€â”€> GORM â”€â”€> MySQL
                     â”‚
                     â””â”€â”€> WebSocket â”€â”€> Manager â”€â”€> Client
```

### ç›®æ ‡æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Client                                â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚    â”‚  Mobile  â”‚                              â”‚   Web    â”‚   â”‚
â”‚    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ HTTP/WSS                               â”‚
          â–¼                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      API Gateway (å¯é€‰)                       â”‚
â”‚         é™æµ | ç†”æ–­ | è®¤è¯ | è´Ÿè½½å‡è¡¡ | è·¯ç”±åˆ†å‘              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â–¼                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   WebSocket Svc  â”‚   â”‚    HTTP API      â”‚   â”‚   Admin API      â”‚
â”‚   (å®æ—¶æ¶ˆæ¯)      â”‚   â”‚   (ä¸šåŠ¡æ¥å£)      â”‚   â”‚   (ç®¡ç†åŠŸèƒ½)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                      â”‚                      â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â–¼                     â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Redis        â”‚   â”‚     Kafka        â”‚   â”‚   MySQL Slave    â”‚
â”‚   (ç¼“å­˜/åœ¨çº¿çŠ¶æ€) â”‚   â”‚   (æ¶ˆæ¯é˜Ÿåˆ—)      â”‚â”‚   â”‚   (è¯»)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚   MySQL Master   â”‚
                       â”‚   (å†™)           â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¼”è¿›è·¯çº¿

| é˜¶æ®µ | ç›®æ ‡ | å…³é”®æŠ€æœ¯ |
|------|------|----------|
| Phase 1 | å®Œå–„æ ¸å¿ƒåŠŸèƒ½ | ç¾¤ç»„ã€æ¶ˆæ¯çŠ¶æ€ã€DTOéš”ç¦» |
| Phase 2 | æ€§èƒ½ä¼˜åŒ– | Redisç¼“å­˜ã€æ¶ˆæ¯åˆ†é¡µ |
| Phase 3 | é«˜å¯ç”¨ | é™æµã€ç†”æ–­ã€æ—¥å¿— |
| Phase 4 | æ‰©å±•æ€§ | æ¶ˆæ¯é˜Ÿåˆ—ã€å¤šç«¯åŒæ­¥ |
| Phase 5 | å¯è§‚æµ‹æ€§ | é“¾è·¯è¿½è¸ªã€ç›‘æ§ |

---

## é™„å½•

### æ•°æ®åº“è¡¨ç»“æ„

#### users è¡¨
```sql
CREATE TABLE `users` (
  `id` bigint unsigned NOT NULL AUTO_INCREMENT,
  `username` varchar(50) NOT NULL COMMENT 'ç”¨æˆ·å',
  `password` varchar(255) NOT NULL COMMENT 'åŠ å¯†å¯†ç ',
  `nickname` varchar(50) NOT NULL DEFAULT '' COMMENT 'æ˜µç§°',
  `avatar` varchar(255) NOT NULL DEFAULT '' COMMENT 'å¤´åƒURL',
  `email` varchar(100) NOT NULL DEFAULT '' COMMENT 'é‚®ç®±',
  `bio` varchar(255) NOT NULL DEFAULT '' COMMENT 'ä¸ªäººç®€ä»‹',
  `status` tinyint NOT NULL DEFAULT 1 COMMENT 'çŠ¶æ€ 0=ç¦ç”¨ 1=æ­£å¸¸',
  `last_login` datetime DEFAULT NULL COMMENT 'æœ€åç™»å½•æ—¶é—´',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `deleted_at` datetime DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `idx_username` (`username`),
  KEY `idx_email` (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç”¨æˆ·è¡¨';
```

#### messages è¡¨
```sql
CREATE TABLE `messages` (
  `id` bigint unsigned NOT NULL AUTO_INCREMENT,
  `from_user_id` bigint unsigned NOT NULL COMMENT 'å‘é€è€…ID',
  `to_user_id` bigint unsigned NOT NULL COMMENT 'æ¥æ”¶è€…ID',
  `content` text NOT NULL COMMENT 'æ¶ˆæ¯å†…å®¹',
  `type` tinyint NOT NULL DEFAULT 2 COMMENT 'æ¶ˆæ¯ç±»å‹ 0=å¿ƒè·³ 1=ç™»å½• 2=å•èŠ 3=ç¾¤èŠ',
  `media` tinyint NOT NULL DEFAULT 1 COMMENT 'åª’ä½“ç±»å‹ 1=æ–‡æœ¬ 2=å›¾ç‰‡ 3=éŸ³é¢‘',
  `status` tinyint NOT NULL DEFAULT 0 COMMENT 'çŠ¶æ€ 0=å·²å‘é€ 1=å·²é€è¾¾ 2=å·²è¯»',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `deleted_at` datetime DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `idx_from_to` (`from_user_id`, `to_user_id`),
  KEY `idx_created_at` (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ¶ˆæ¯è¡¨';
```

### ç›¸å…³æ–‡æ¡£é“¾æ¥

- [Swagger API æ–‡æ¡£](/swagger/index.html)
- [Gin å®˜æ–¹æ–‡æ¡£](https://gin-gonic.com/)
- [GORM å®˜æ–¹æ–‡æ¡£](https://gorm.io/)
- [Gorilla WebSocket](https://pkg.go.dev/github.com/gorilla/websocket)
